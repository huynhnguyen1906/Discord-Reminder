name: ğŸ›ï¸ Nitroãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼

on:
  schedule:
    - cron: "0 1 * * *" # 10:00 JST = 01:00 UTC (cháº¡y má»—i ngÃ y lÃºc 10h sÃ¡ng JST)
  workflow_dispatch: # Cho phÃ©p cháº¡y thá»§ cÃ´ng Ä‘á»ƒ test

jobs:
  daily-nitro-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ”” Discordã§ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é€šçŸ¥
        run: |
          # NgÃ y hÃ´m nay (UTC)
          TODAY=$(date -u +"%Y-%m-%d")

          # NgÃ y Ä‘Ã­ch
          TARGET_DATE="2026-06-08"

          # TÃ­nh sá»‘ ngÃ y cÃ²n láº¡i
          DAYS_LEFT=$(( ( $(date -d "$TARGET_DATE" +%s) - $(date -d "$TODAY" +%s) ) / 86400 ))

          # ID ngÆ°á»i dÃ¹ng Ä‘á»ƒ tag
          USER_ID="400990876463136768"

          # Táº¡o prompt cho OpenAI
          PROMPT="Táº¡o má»™t tin nháº¯n báº±ng tiáº¿ng Nháº­t Ä‘á»ƒ nháº¯c nhá»Ÿ/Ä‘Ã²i ná»£ má»™t ngÆ°á»i cá»¥ thá»ƒ mua Discord Nitro cho má»i ngÆ°á»i trong server. CÃ²n ${DAYS_LEFT} ngÃ y ná»¯a Ä‘áº¿n ngÃ y há»©a háº¹n. Message pháº£i cÃ³ tÃ­nh cháº¥t gá»i tÃªn, nháº¯c nhá»Ÿ trá»±c tiáº¿p ngÆ°á»i Ä‘Ã³ (nhÆ° 'ã‚ãªãŸ', 'ãã¿', 'ãŠå‰'). Phong cÃ¡ch cÃ³ thá»ƒ cute, hÃ i hÆ°á»›c, báº©n bá»±a, Ä‘Ã²i ná»£, hoáº·c lÃ m tÃ¬nh. Chá»‰ tráº£ vá» ná»™i dung tin nháº¯n, khÃ´ng cáº§n @mention. Sá»­ dá»¥ng emoji phÃ¹ há»£p."

          # Gá»i OpenAI API Ä‘á»ƒ táº¡o message
          AI_RESPONSE=$(curl -s -X POST "https://api.openai.com/v1/chat/completions" \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d "{
              \"model\": \"gpt-4o-mini\",
              \"messages\": [{\"role\": \"user\", \"content\": \"${PROMPT}\"}],
              \"max_tokens\": 200,
              \"temperature\": 0.9
            }")

          # Extract message tá»« OpenAI response
          AI_MESSAGE=$(echo "$AI_RESPONSE" | jq -r '.choices[0].message.content' 2>/dev/null || echo "")

          # Fallback message náº¿u API lá»—i
          if [ -z "$AI_MESSAGE" ] || [ "$AI_MESSAGE" = "null" ]; then
            AI_MESSAGE="Nitroã‚’ã¿ã‚“ãªã«è²·ã£ã¦ãã‚Œã‚‹æ—¥ã¾ã§ã€ã‚ã¨ **${DAYS_LEFT}æ—¥** ã ã‚ˆï¼ğŸ‰ æº–å‚™ã¯ãƒãƒƒãƒãƒªï¼ŸğŸ˜âœ¨"
          fi

          # Káº¿t há»£p mention user vá»›i AI message
          FINAL_MESSAGE="<@${USER_ID}> ã•ã‚“ã€\n${AI_MESSAGE}"

          # Gá»­i Ä‘áº¿n Discord Webhook
          curl -X POST -H "Content-Type: application/json" \
            -d "{
              \"content\": \"${FINAL_MESSAGE}\",
              \"allowed_mentions\": {
                \"users\": [\"${USER_ID}\"]
              }
            }" \
            ${{ secrets.DISCORD_WEBHOOK_URL }}
